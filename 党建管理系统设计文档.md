# 党建管理系统设计文档

## 1. 系统架构设计

### 1.1 总体架构
```
┌─────────────────────────────────────────────────────────────┐
│                    前端展示层 (Vue.js)                        │
├─────────────────────────────────────────────────────────────┤
│                    API网关层 (Spring Gateway)                 │
├─────────────────────────────────────────────────────────────┤
│                    业务逻辑层 (Spring Boot)                   │
├─────────────────────────────────────────────────────────────┤
│                    数据访问层 (Spring Data JPA)               │
├─────────────────────────────────────────────────────────────┤
│                    数据存储层 (Mock Data)                     │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 技术架构
- **前端框架**: Vue 3 + Element Plus + Vue Router + Pinia
- **后端框架**: Spring Boot + Spring Security + Spring Data JPA
- **数据层**: Mock数据服务
- **缓存**: 内存缓存
- **文档**: Swagger/OpenAPI 3.0

## 2. 系统模块设计

### 2.1 前端模块结构
```
src/
├── components/          # 公共组件
│   ├── common/          # 通用组件
│   ├── layout/          # 布局组件
│   └── business/        # 业务组件
├── views/               # 页面视图
│   ├── login/           # 登录页面
│   ├── dashboard/       # 仪表板
│   ├── member/          # 党员管理
│   ├── organization/    # 组织管理
│   ├── activity/        # 党组织生活
│   ├── fee/             # 党费管理
│   ├── study/           # 学习教育
│   ├── evaluation/      # 考核评价
│   └── notice/          # 通知公告
├── router/              # 路由配置
├── store/               # 状态管理
├── api/                 # API接口
├── utils/               # 工具函数
└── assets/              # 静态资源
```

### 2.2 后端模块结构
```
src/main/java/com/party/
├── config/              # 配置类
├── controller/          # 控制器层
│   ├── AuthController.java
│   ├── MemberController.java
│   ├── OrganizationController.java
│   ├── ActivityController.java
│   ├── FeeController.java
│   ├── StudyController.java
│   ├── EvaluationController.java
│   └── NoticeController.java
├── service/             # 业务逻辑层
│   ├── impl/            # 实现类
│   └── interfaces/      # 接口定义
├── entity/              # 实体类
├── dto/                 # 数据传输对象
├── repository/          # 数据访问层
├── mock/                # Mock数据服务
├── security/            # 安全配置
└── utils/               # 工具类
```

## 3. 数据库设计

### 3.1 核心数据表设计

#### 用户表 (users)
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    real_name VARCHAR(50) NOT NULL,
    id_card VARCHAR(18),
    phone VARCHAR(11),
    email VARCHAR(100),
    gender TINYINT,
    birth_date DATE,
    join_party_date DATE,
    party_status TINYINT DEFAULT 1,
    organization_id BIGINT,
    role_id BIGINT,
    avatar_url VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 组织架构表 (organizations)
```sql
CREATE TABLE organizations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE,
    type TINYINT NOT NULL, -- 1:党委 2:党总支 3:党支部
    parent_id BIGINT,
    level INT DEFAULT 1,
    secretary_id BIGINT,
    description TEXT,
    address VARCHAR(255),
    contact_phone VARCHAR(20),
    established_date DATE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 角色表 (roles)
```sql
CREATE TABLE roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    code VARCHAR(50) UNIQUE,
    description VARCHAR(255),
    permissions JSON,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 活动表 (activities)
```sql
CREATE TABLE activities (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    type TINYINT NOT NULL, -- 1:支部大会 2:支委会 3:党小组会 4:党课 5:主题党日
    content TEXT,
    location VARCHAR(255),
    start_time DATETIME,
    end_time DATETIME,
    organizer_id BIGINT,
    organization_id BIGINT,
    status TINYINT DEFAULT 1, -- 1:计划中 2:进行中 3:已结束 4:已取消
    max_participants INT,
    is_required BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 活动参与表 (activity_participants)
```sql
CREATE TABLE activity_participants (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    activity_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    status TINYINT DEFAULT 1, -- 1:已报名 2:已签到 3:请假 4:缺席
    sign_in_time DATETIME,
    notes VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 党费记录表 (party_fees)
```sql
CREATE TABLE party_fees (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    fee_month VARCHAR(7) NOT NULL, -- YYYY-MM格式
    payment_date DATE,
    payment_method TINYINT, -- 1:现金 2:转账 3:代扣
    collector_id BIGINT,
    status TINYINT DEFAULT 1, -- 1:待缴 2:已缴 3:逾期
    notes VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 学习资源表 (study_resources)
```sql
CREATE TABLE study_resources (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    type TINYINT NOT NULL, -- 1:文档 2:视频 3:图片 4:链接
    category_id BIGINT,
    content TEXT,
    file_url VARCHAR(500),
    file_size BIGINT,
    duration INT, -- 视频时长(秒)
    author VARCHAR(100),
    publisher_id BIGINT,
    view_count INT DEFAULT 0,
    download_count INT DEFAULT 0,
    is_featured BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 学习记录表 (study_records)
```sql
CREATE TABLE study_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    resource_id BIGINT NOT NULL,
    progress INT DEFAULT 0, -- 学习进度百分比
    study_time INT DEFAULT 0, -- 学习时长(秒)
    last_position INT DEFAULT 0, -- 最后学习位置
    is_completed BOOLEAN DEFAULT FALSE,
    notes TEXT,
    rating TINYINT, -- 评分1-5
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 通知公告表 (notices)
```sql
CREATE TABLE notices (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    type TINYINT DEFAULT 1, -- 1:通知 2:公告 3:紧急通知
    priority TINYINT DEFAULT 1, -- 1:普通 2:重要 3:紧急
    publisher_id BIGINT NOT NULL,
    target_type TINYINT DEFAULT 1, -- 1:全部 2:指定组织 3:指定用户
    target_ids JSON, -- 目标ID列表
    is_top BOOLEAN DEFAULT FALSE,
    publish_time DATETIME,
    expire_time DATETIME,
    read_count INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## 4. API接口设计

### 4.1 认证授权接口
```
POST /api/auth/login          # 用户登录
POST /api/auth/logout         # 用户登出
POST /api/auth/refresh        # 刷新Token
GET  /api/auth/profile        # 获取用户信息
PUT  /api/auth/profile        # 更新用户信息
POST /api/auth/change-password # 修改密码
```

### 4.2 用户管理接口
```
GET    /api/users             # 获取用户列表
POST   /api/users             # 创建用户
GET    /api/users/{id}        # 获取用户详情
PUT    /api/users/{id}        # 更新用户信息
DELETE /api/users/{id}        # 删除用户
POST   /api/users/{id}/activate   # 激活用户
POST   /api/users/{id}/deactivate # 停用用户
```

### 4.3 组织管理接口
```
GET    /api/organizations     # 获取组织列表
POST   /api/organizations     # 创建组织
GET    /api/organizations/{id} # 获取组织详情
PUT    /api/organizations/{id} # 更新组织信息
DELETE /api/organizations/{id} # 删除组织
GET    /api/organizations/tree # 获取组织树
GET    /api/organizations/{id}/members # 获取组织成员
```

### 4.4 活动管理接口
```
GET    /api/activities        # 获取活动列表
POST   /api/activities        # 创建活动
GET    /api/activities/{id}   # 获取活动详情
PUT    /api/activities/{id}   # 更新活动信息
DELETE /api/activities/{id}   # 删除活动
POST   /api/activities/{id}/join    # 参加活动
POST   /api/activities/{id}/sign-in # 活动签到
GET    /api/activities/{id}/participants # 获取参与者列表
```

### 4.5 党费管理接口
```
GET    /api/party-fees        # 获取党费记录
POST   /api/party-fees        # 创建党费记录
PUT    /api/party-fees/{id}   # 更新党费记录
POST   /api/party-fees/{id}/pay # 缴纳党费
GET    /api/party-fees/statistics # 党费统计
GET    /api/party-fees/unpaid # 未缴费记录
```

### 4.6 学习教育接口
```
GET    /api/study/resources   # 获取学习资源
POST   /api/study/resources   # 上传学习资源
GET    /api/study/resources/{id} # 获取资源详情
POST   /api/study/records     # 记录学习进度
GET    /api/study/records     # 获取学习记录
GET    /api/study/statistics  # 学习统计
```

### 4.7 通知公告接口
```
GET    /api/notices           # 获取通知列表
POST   /api/notices           # 发布通知
GET    /api/notices/{id}      # 获取通知详情
PUT    /api/notices/{id}      # 更新通知
DELETE /api/notices/{id}      # 删除通知
POST   /api/notices/{id}/read # 标记已读
```

## 5. 前端页面设计

### 5.1 登录页面
- 用户名/密码登录
- 记住密码功能
- 忘记密码链接
- 党建主题背景

### 5.2 首页仪表板
- 个人信息卡片
- 待办事项提醒
- 最新通知公告
- 组织生活日历
- 学习进度统计
- 党费缴纳状态

### 5.3 党员管理页面
- 党员列表（支持搜索、筛选、分页）
- 党员详情查看/编辑
- 党员档案管理
- 组织关系转接
- 批量操作功能

### 5.4 组织管理页面
- 组织架构树形展示
- 组织信息维护
- 成员管理
- 职务任免

### 5.5 党组织生活页面
- 活动日历视图
- 活动列表视图
- 活动详情页面
- 活动创建/编辑表单
- 签到管理

### 5.6 党费管理页面
- 党费收缴记录
- 缴费状态统计
- 财务报表
- 缴费提醒设置

### 5.7 学习教育页面
- 学习资源分类浏览
- 在线学习界面
- 学习进度跟踪
- 学习笔记管理

### 5.8 考核评价页面
- 积分管理
- 民主评议
- 评价统计
- 排行榜

## 6. 安全设计

### 6.1 认证机制
- JWT Token认证
- Token自动刷新
- 登录状态保持
- 多设备登录控制

### 6.2 权限控制
- 基于角色的访问控制(RBAC)
- 菜单权限控制
- 按钮级权限控制
- 数据权限控制

### 6.3 数据安全
- 敏感信息加密
- SQL注入防护
- XSS攻击防护
- CSRF攻击防护

### 6.4 操作审计
- 用户操作日志
- 系统访问日志
- 数据变更日志
- 异常操作告警

## 7. 性能优化设计

### 7.1 前端优化
- 组件懒加载
- 路由懒加载
- 图片懒加载
- 虚拟滚动
- 缓存策略

### 7.2 后端优化
- 数据库查询优化
- 接口响应缓存
- 分页查询
- 异步处理
- 连接池配置

### 7.3 系统监控
- 接口性能监控
- 系统资源监控
- 错误日志监控
- 用户行为分析

## 8. 部署架构

### 8.1 开发环境
- 前端：npm run dev
- 后端：Spring Boot内嵌Tomcat
- 数据：Mock数据服务

### 8.2 生产环境（预留）
- 前端：Nginx静态文件服务
- 后端：Docker容器部署
- 数据库：MySQL主从架构
- 缓存：Redis集群
- 负载均衡：Nginx

## 9. 开发规范

### 9.1 代码规范
- 前端：ESLint + Prettier
- 后端：Checkstyle + SpotBugs
- 命名规范：驼峰命名法
- 注释规范：JavaDoc/JSDoc

### 9.2 Git规范
- 分支策略：GitFlow
- 提交信息：Conventional Commits
- 代码审查：Pull Request
- 版本标签：语义化版本

### 9.3 测试规范
- 单元测试覆盖率 > 80%
- 集成测试
- 端到端测试
- 性能测试

## 10. 项目计划

### 10.1 开发阶段
- **第1-2周**: 项目初始化，基础框架搭建
- **第3-4周**: 用户认证和权限管理
- **第5-6周**: 党员和组织管理模块
- **第7-8周**: 党组织生活模块
- **第9-10周**: 党费管理模块
- **第11-12周**: 学习教育模块
- **第13-14周**: 系统集成测试和优化

### 10.2 里程碑
- **里程碑1**: 基础框架完成
- **里程碑2**: 核心功能完成
- **里程碑3**: 系统测试完成
- **里程碑4**: 项目交付

## 11. 风险控制

### 11.1 技术风险
- 新技术学习曲线
- 系统集成复杂度
- 性能瓶颈问题

### 11.2 进度风险
- 需求变更影响
- 开发资源不足
- 测试时间压缩

### 11.3 质量风险
- 代码质量控制
- 测试覆盖不足
- 用户体验问题

### 11.4 应对措施
- 技术预研和培训
- 敏捷开发方法
- 持续集成部署
- 定期代码审查
- 用户反馈收集