# 党建管理系统设计文档

## 1. 系统架构设计

### 1.1 整体架构

```mermaid
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    role VARCHAR(20) DEFAULT 'MEMBER',
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
```

### 1.2 技术栈

**前端技术栈**:

* Vue.js 3.x - 渐进式JavaScript框架

* Vite - 构建工具

* Element Plus - UI组件库

* Pinia - 状态管理

* Vue Router - 路由管理

* Axios - HTTP客户端

**后端技术栈**:

* Spring Boot 2.7.14 - 应用框架

* Spring Security - 安全框架

* Spring Data JPA - 数据访问

* JWT - 身份认证

* H2 Database - 开发环境数据库

* MySQL - 生产环境数据库

* Redis - 缓存

* Maven - 构建工具

## 2. 系统模块设计

### 2.1 认证授权模块

```mermaid
sequenceDiagram
    participant U as 用户
    participant F as 前端
    participant A as 认证服务
    participant D as 数据库
    
    U->>F: 输入用户名密码
    F->>A: POST /api/auth/login
    A->>D: 验证用户凭据
    D-->>A: 返回用户信息
    A->>A: 生成JWT Token
    A-->>F: 返回Token和用户信息
    F->>F: 存储Token到localStorage
    F-->>U: 跳转到工作台
```

### 2.2 用户管理模块

```mermaid
sequenceDiagram
    participant A as 管理员
    participant F as 前端
    participant U as 用户服务
    participant D as 数据库
    
    A->>F: 创建用户请求
    F->>U: POST /api/users
    U->>U: 验证数据格式
    U->>D: 检查用户名/邮箱唯一性
    D-->>U: 返回检查结果
    alt 数据有效
        U->>D: 保存用户信息
        D-->>U: 返回保存结果
        U-->>F: 返回成功响应
        F-->>A: 显示成功提示
    else 数据无效
        U-->>F: 返回错误信息
        F-->>A: 显示错误提示
    end
```

### 2.3 组织架构模块

```mermaid
sequenceDiagram
    participant U as 用户
    participant F as 前端
    participant O as 组织服务
    participant D as 数据库
    
    U->>F: 访问组织架构页面
    F->>O: GET /api/organizations/tree
    O->>D: 查询组织层级数据
    D-->>O: 返回组织树数据
    O->>O: 构建树形结构
    O-->>F: 返回树形数据
    F->>F: 渲染组织树组件
    F-->>U: 显示组织架构
```

### 2.4 活动管理模块

```mermaid
sequenceDiagram
    participant O as 组织者
    participant P as 参与者
    participant F as 前端
    participant A as 活动服务
    participant N as 通知服务
    participant D as 数据库
    
    O->>F: 创建活动
    F->>A: POST /api/activities
    A->>D: 保存活动信息
    A->>N: 发送活动通知
    N->>P: 推送活动通知
    
    P->>F: 报名参加
    F->>A: POST /api/activities/{id}/register
    A->>D: 记录报名信息
    A-->>F: 返回报名结果
    
    P->>F: 活动签到
    F->>A: POST /api/activities/{id}/checkin
    A->>D: 记录签到信息
    A-->>F: 返回签到结果
```

## 3. 数据库设计

### 3.1 核心实体关系图

```mermaid
erDiagram
    USER ||--o{ USER_ORGANIZATION : belongs_to
    ORGANIZATION ||--o{ USER_ORGANIZATION : contains
    ORGANIZATION ||--o{ ORGANIZATION : parent_child
    ORGANIZATION ||--o{ ACTIVITY : organizes
    USER ||--o{ ACTIVITY_REGISTRATION : registers
    ACTIVITY ||--o{ ACTIVITY_REGISTRATION : has
    USER ||--o{ ACTIVITY_CHECKIN : checkin
    ACTIVITY ||--o{ ACTIVITY_CHECKIN : records
    USER ||--o{ PARTY_FEE : pays
    USER ||--o{ LEARNING_RECORD : learns
    USER ||--o{ NOTIFICATION : receives
    
    USER {
        bigint id PK
        varchar username UK
        varchar password
        varchar name
        varchar email UK
        varchar phone
        varchar role
        varchar status
        datetime created_at
        datetime updated_at
    }
    
    ORGANIZATION {
        bigint id PK
        varchar name
        varchar code UK
        varchar type
        varchar description
        bigint parent_id FK
        varchar status
        datetime created_at
        datetime updated_at
    }
    
    ACTIVITY {
        bigint id PK
        varchar title
        text description
        varchar type
        datetime start_time
        datetime end_time
        varchar location
        int max_participants
        varchar status
        bigint organizer_id FK
        bigint organization_id FK
        datetime created_at
        datetime updated_at
    }
    
    ACTIVITY_REGISTRATION {
        bigint id PK
        bigint user_id FK
        bigint activity_id FK
        varchar status
        datetime registered_at
    }
    
    ACTIVITY_CHECKIN {
        bigint id PK
        bigint user_id FK
        bigint activity_id FK
        datetime checkin_time
        varchar location
    }
    
    PARTY_FEE {
        bigint id PK
        bigint user_id FK
        decimal amount
        varchar period
        varchar status
        datetime paid_at
        datetime created_at
    }
    
    LEARNING_RECORD {
        bigint id PK
        bigint user_id FK
        varchar resource_title
        varchar resource_type
        int progress
        int duration
        datetime started_at
        datetime completed_at
    }
    
    NOTIFICATION {
        bigint id PK
        bigint user_id FK
        varchar title
        text content
        varchar type
        varchar status
        datetime created_at
        datetime read_at
    }
```

### 3.2 数据库表结构

#### 用户表 (users)

```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    role VARCHAR(20) DEFAULT 'MEMBER',
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
```

#### 组织表 (organizations)

```sql
CREATE TABLE organizations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    type VARCHAR(20) NOT NULL,
    description TEXT,
    parent_id BIGINT,
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES organizations(id)
);

CREATE INDEX idx_organizations_parent_id ON organizations(parent_id);
CREATE INDEX idx_organizations_type ON organizations(type);
```

#### 活动表 (activities)

```sql
CREATE TABLE activities (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    type VARCHAR(50) NOT NULL,
    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP NOT NULL,
    location VARCHAR(200),
    max_participants INT DEFAULT 0,
    status VARCHAR(20) DEFAULT 'PLANNING',
    organizer_id BIGINT NOT NULL,
    organization_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (organizer_id) REFERENCES users(id),
    FOREIGN KEY (organization_id) REFERENCES organizations(id)
);

CREATE INDEX idx_activities_start_time ON activities(start_time);
CREATE INDEX idx_activities_organizer_id ON activities(organizer_id);
CREATE INDEX idx_activities_organization_id ON activities(organization_id);
```

## 4. API接口设计

### 4.1 认证接口

#### 用户登录

```
POST /api/auth/login
```

**请求参数**:

| 参数名      | 类型     | 必填 | 描述  |
| -------- | ------ | -- | --- |
| username | string | 是  | 用户名 |
| password | string | 是  | 密码  |

**响应示例**:

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "admin",
      "name": "管理员",
      "role": "ADMIN"
    }
  }
}
```

### 4.2 用户管理接口

#### 获取用户列表

```
GET /api/users
```

**查询参数**:

| 参数名            | 类型     | 必填 | 描述        |
| -------------- | ------ | -- | --------- |
| page           | int    | 否  | 页码，默认1    |
| size           | int    | 否  | 每页大小，默认10 |
| keyword        | string | 否  | 搜索关键词     |
| organizationId | long   | 否  | 组织ID      |
| role           | string | 否  | 角色筛选      |

#### 创建用户

```
POST /api/users
```

**请求参数**:

```json
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    role VARCHAR(20) DEFAULT 'MEMBER',
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
```

### 4.3 组织管理接口

#### 获取组织树

```
GET /api/organizations/tree
```

**响应示例**:

```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "name": "党委",
      "code": "PC001",
      "type": "PARTY_COMMITTEE",
      "children": [
        {
          "id": 2,
          "name": "第一党支部",
          "code": "PB001",
          "type": "PARTY_BRANCH",
          "children": []
        }
      ]
    }
  ]
}
```

### 4.4 活动管理接口

#### 创建活动

```
POST /api/activities
```

**请求参数**:

```json
{
  "title": "主题党日活动",
  "description": "学习党的二十大精神",
  "type": "THEME_PARTY_DAY",
  "startTime": "2024-01-15T09:00:00",
  "endTime": "2024-01-15T11:00:00",
  "location": "会议室A",
  "maxParticipants": 50,
  "organizationId": 2
}
```

#### 活动报名

```
POST /api/activities/{id}/register
```

#### 活动签到

```
POST /api/activities/{id}/checkin
```

## 5. 安全设计

### 5.1 认证机制

* 使用JWT Token进行身份认证

* Token有效期24小时，支持刷新

* 密码使用BCrypt加密存储

### 5.2 权限控制

* 基于角色的访问控制(RBAC)

* 方法级权限注解

* 前端路由权限守卫

### 5.3 数据安全

* 敏感数据加密存储

* SQL注入防护

* XSS攻击防护

* CSRF攻击防护

## 6. 性能优化

### 6.1 缓存策略

* Redis缓存用户会话信息

* 缓存组织架构数据

* 缓存热点查询结果

### 6.2 数据库优化

* 合理设计索引

* 分页查询优化

* 连接池配置优化

### 6.3 前端优化

* 组件懒加载

* 图片懒加载

* 打包优化

* CDN加速

## 7. 部署架构

### 7.1 开发环境

* 前端: Vite开发服务器

* 后端: Spring Boot内嵌Tomcat

* 数据库: H2内存数据库

* 缓存: 内存缓存

### 7.2 生产环境

* 前端: Nginx静态文件服务

* 后端: Docker容器部署

* 数据库: MySQL主从复制

* 缓存: Redis集群

* 负载均衡: Nginx

## 8. 监控和日志

### 8.1 应用监控

* Spring Boot Actuator健康检查

* 性能指标监控

* 错误率监控

### 8.2 日志管理

* 结构化日志输出

* 日志级别配置

* 日志文件轮转

* 操作审计日志

***

**文档版本**: 1.0\
**创建日期**: 2024年\
**最后更新**: 2024年\
**文档状态**: 设计阶段
