# Spec Workflow：需求分析->系统设计->实施计划->用例设计
# 全局设置
- 所有的对话方式都采用中文对话
- 所有的文档都采用中文编写
- 所有的文档都必须在'docs'目录下
- 所有的前端代码都必须在'frontend'目录下
- 所有的后端代码都必须在'backend'目录下
- 所有的测试脚本都必须在'tests'目录下  
- 所有的测试数据都必须在'data'目录下
- 所有的文档都必须采用Markdown格式编写
- 所有的代码都必须采用中文注释



# 需求分析文档生成
对话方式：中文对话
工作流阶段：需求分析

首先，基于功能想法以EARS格式生成初始需求集，然后与用户迭代完善，直到需求完整准确。

在这个阶段不要关注代码探索。相反，只需专注于编写需求，这些需求后续将转化为设计。

**约束条件：**

- 模型必须在'docs/{feature_name}/requirements.md'不存在时创建该文件
- 模型必须基于用户的粗略想法生成需求文档的初始版本，无需先进行连续提问
- 模型必须按以下格式编写初始requirements.md文档：
  - 清晰概述功能的介绍部分
  - 层级编号的需求列表，每项包含：
    - 用户故事，格式为"作为[角色]，我想要[功能]，以便[好处]"
    - 以EARS格式(易于理解的需求语法)编写的验收标准编号列表
  - 示例格式：
[此处包含示例格式]
- 模型应在初始需求中考虑边缘情况、用户体验、技术约束和成功标准
- 更新需求文档后，模型必须使用'userInput'工具询问用户"需求看起来可以吗？如果可以，我们可以进入设计阶段。"
- 'userInput'工具必须使用精确字符串'spec-requirements-review'作为原因
- 如果用户要求更改或未明确批准，模型必须修改需求文档
- 模型必须在每次编辑需求文档后请求明确批准
- 在收到明确批准(如"是"、"批准"、"看起来不错"等)之前，模型不得进入系统设计阶段
- 模型必须继续反馈-修订循环，直到收到明确批准
- 模型应建议可能需要澄清或扩展的具体领域
- 模型可以针对需要澄清的需求特定方面提出有针对性的问题
- 当用户对某个方面不确定时，模型可以提出建议选项
- 用户接受需求后，模型必须进入系统设计阶段

# 系统设计文档生成
对话方式：中文对话
工作流阶段：系统设计

用户批准需求后，你应该基于功能需求开发全面的系统设计文档，在设计过程中进行必要的研究。
系统设计文档应基于需求分析文档，所以首先确保需求分析文档存在。

**约束条件：**

- 模型必须在'docs/{feature_name}/design.md'不存在时创建该文件
- 模型必须根据功能需求确定需要研究的领域
- 模型必须在对话线程中进行研究并建立上下文
- 模型不应创建单独的研究文件，而应将研究作为设计和实施计划的上下文
- 模型必须总结将影响功能设计的关键发现
- 模型应在对话中引用来源并包含相关链接
- 模型必须在'docs/{feature_name}/design.md'创建详细的设计文档
- 模型必须将研究发现直接纳入设计过程
- 模型必须在系统设计文档中包含以下部分：
  - 概述
  - 架构
  - 组件和接口
  - 数据模型
  - 错误处理
  - 测试策略
- 在适当时模型应包含图表或可视化表示(使用Mermaid绘制图表)
- 模型必须确保设计涵盖在澄清过程中确定的所有功能需求
- 模型应突出设计决策及其理由
- 模型可以在设计过程中就具体技术决策征求用户意见
- 更新设计文档后，模型必须使用'userInput'工具询问用户"设计看起来可以吗？如果可以，我们可以进入实施计划。"
- 'userInput'工具必须使用精确字符串'spec-design-review'作为原因
- 如果用户要求更改或未明确批准，模型必须修改设计文档
- 模型必须在每次编辑设计文档后请求明确批准
- 在收到明确批准(如"是"、"批准"、"看起来不错"等)之前，模型不得进入实施计划
- 模型必须继续反馈-修订循环，直到收到明确批准
- 在继续之前，模型必须将所有用户反馈纳入设计文档
- 如果在设计过程中发现差距，模型必须提供返回功能需求澄清的选项

# 实施计划文档生成
对话方式：中文对话
工作流阶段：实施计划

用户批准设计后，基于需求和设计创建一个可执行的计划，包含编码任务清单。
任务文档应基于设计文档，所以首先确保设计文档存在。

**约束条件：**

- 模型必须在'docs/{feature_name}/tasks.md'不存在时创建该文件
- 如果用户表示需要对设计进行更改，模型必须返回设计步骤
- 如果用户表示需要额外需求，模型必须返回需求步骤
- 模型必须在'docs/{feature_name}/tasks.md'创建实施计划
- 创建实施计划时，模型必须遵循以下具体指示：将功能设计转换为一系列提示，供代码生成LLM以测试驱动方式实施每个步骤。优先考虑最佳实践、渐进式进展和早期测试，确保任何阶段都不会出现复杂性的大幅跳跃。确保每个提示都建立在前面的提示之上，并以将各部分连接在一起结束。不应有任何未与前一步骤集成的悬空或孤立代码。仅关注涉及编写、修改或测试代码的任务。
- 模型必须将实施计划格式化为最多两级层次的编号复选框列表：
  - 仅在需要时使用顶级项目(如史诗)
  - 子任务应使用小数点表示法编号(如1.1、1.2、2.1)
  - 每个项目必须是复选框
  - 优先选择简单结构
- 模型必须确保每个任务项目包含：
  - 涉及编写、修改或测试代码的清晰任务目标描述
  - 任务下的附加信息子项
  - 对需求文档中具体需求的引用(引用具体子需求，而不仅是用户故事)
- 模型必须确保实施计划是一系列离散的、可管理的编码步骤
- 模型必须确保每个任务引用需求文档中的具体需求
- 模型不得包含设计文档中已涵盖的过多实施细节
- 模型必须假设实施过程中可获得所有上下文文档(功能需求、设计)
- 模型必须确保每个步骤都在前面步骤的基础上逐步构建
- 在适当情况下，模型应优先考虑测试驱动开发
- 模型必须确保计划涵盖可通过代码实施的设计的所有方面
- 模型应安排步骤顺序，以便通过代码尽早验证核心功能
- 模型必须确保所有需求都被实施任务覆盖
- 如果在实施规划过程中发现差距，模型必须提供返回前面步骤(需求或设计)的选项
- 模型必须仅包含可由编码代理执行的任务(编写代码、创建测试等)
- 模型不得包含与用户测试、部署、性能指标收集或其他非编码活动相关的任务
- 模型必须专注于可在开发环境中执行的代码实施任务
- 模型必须遵循以下准则确保每个任务可由编码代理执行：
  - 任务应涉及编写、修改或测试特定代码组件
  - 任务应指定需要创建或修改的文件或组件
  - 任务应具体到编码代理无需额外澄清即可执行
  - 任务应关注实施细节而非高层概念
  - 任务应限定在具体编码活动范围内(如"实现X函数"而非"支持X功能")
- 模型必须明确避免在实施计划中包含以下类型的非编码任务：
  - 用户验收测试或用户反馈收集
  - 部署到生产或暂存环境
  - 性能指标收集或分析
  - 运行应用程序测试端到端流程。但我们可以编写自动化测试从用户角度测试端到端流程。
  - 用户培训或文档创建
  - 业务流程变更或组织变更
  - 营销或沟通活动
  - 任何无法通过编写、修改或测试代码完成的任务
- 更新任务文档后，模型必须使用'userInput'工具询问用户"任务看起来可以吗？"
- 'userInput'工具必须使用精确字符串'spec-tasks-review'作为原因
- 如果用户要求更改或未明确批准，模型必须修改任务文档
- 模型必须在每次编辑任务文档后请求明确批准
- 在收到明确批准(如"是"、"批准"、"看起来不错"等)之前，模型不得进入用例设计阶段
- 模型必须继续反馈-修订循环，直到收到明确批准

# 测试用例文档生成
对话方式：中文对话
工作流阶段：用例设计

用户确认实施计划后，基于需求与设计文档创建一个Playwright可理解的测试用例文档，编写格式遵循ERAS规范。
用例文档应基于设计文档，所以首先确保设计文档存在。

**约束条件：**

- 模型必须在'docs/{feature_name}/tests.md'不存在时创建该文件
- 如果用户表示需要对设计进行更改，模型必须返回设计步骤
- 如果用户表示需要额外需求，模型必须返回需求步骤
- 模型必须在'docs/{feature_name}/tests.md'创建测试用例文档
- 测试用例文档必须遵循ERAS规范
- 测试用例文档必须包含以下部分：
- 用例标题
- 用例描述
- 用例步骤
- 用例预期结果
- 用例优先级
- 用例标签
- 用例关联需求
- 更新任务文档后，模型必须使用'userInput'工具询问用户"用例看起来可以吗？"
- 'userInput'工具必须使用精确字符串'spec-tests-review'作为原因
- 如果用户要求更改或未明确批准，模型必须修改用例文档
- 模型必须在每次编辑用例文档后请求明确批准
- 在收到明确批准(如"是"、"批准"、"看起来不错"等)之前，模型不得认为工作流完成
- 模型必须继续反馈-修订循环，直到收到明确批准
- 用例文档获得批准后，模型必须停止


**此工作流仅用于创建设计和规划文档。功能的实际实施应通过单独的工作流完成。**

- 模型的对话方式必须采用中文
- 模型不得尝试作为此工作流的一部分实施功能
- 设计和规划文档创建完成后，模型必须向用户明确传达此工作流已完成
- 模型必须告知用户，他们可以通过打开tasks.md文件并点击任务项目旁的"Start task"来开始执行任务
- 模型必须告知用户，他们可以通过打开tests.md文件并点击任务项目旁的"Start task"来开始生成自动化测试脚本
